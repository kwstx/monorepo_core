openapi: 3.0.0
info:
  title: Agent-to-Agent (A2A) Coordination API
  description: A standalone service for autonomous agent negotiation, contract management, and settlement.
  version: 1.0.0
servers:
  - url: http://localhost:3000/api/v1
    description: Local development server

paths:
  /negotiate:
    post:
      summary: Advance a negotiation session
      description: Submits a proposal, counterproposal, or acceptance message to advance the state of a negotiation.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sessionId:
                  type: string
                  description: Optional session ID. If not provided, a new session is created.
                message:
                  $ref: '#/components/schemas/AgentCoordinationMessage'
      responses:
        '200':
          description: Negotiation transition result
          content:
            application/json:
              schema:
                type: object
                properties:
                  sessionId:
                    type: string
                  result:
                    $ref: '#/components/schemas/TransitionResult'

  /contracts:
    post:
      summary: Finalize negotiation and create a contract
      description: Converts a finalized negotiation session into an active formal contract.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sessionId:
                  type: string
      responses:
        '201':
          description: Contract created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SharedTaskContract'

  /validate:
    post:
      summary: Validate a coordination message
      description: Checks a message against policies, guardrails, and compliance rules.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentCoordinationMessage'
      responses:
        '200':
          description: Validation results

  /recommendations:
    post:
      summary: Recommend pre-negotiation agent pairings or coalitions
      description: Ranks candidate pairs/coalitions using historical outcomes, synergy links, and economic performance.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecommendationRequest'
      responses:
        '200':
          description: Ranked collaboration recommendations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecommendationResponse'

  /execute/confirm:
    post:
      summary: Confirm task execution and trigger settlement
      description: Confirms that a contracted task has been executed and processes rewards/penalties.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                contractId:
                  type: string
                outcomes:
                  type: array
                  items:
                    $ref: '#/components/schemas/ActualDeliverable'
      responses:
        '200':
          description: Settlement report

  /disputes:
    post:
      summary: Resolve a coordination dispute
      description: Evaluates conflicting messages or resource overlaps to resolve coordination friction.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sessionId:
                  type: string
                message:
                  $ref: '#/components/schemas/AgentCoordinationMessage'
      responses:
        '200':
          description: Dispute resolution result

components:
  schemas:
    AgentCoordinationMessage:
      type: object
      required: [messageId, sender, recipient, type, content]
      properties:
        messageId: { type: string }
        correlationId: { type: string }
        timestamp: { type: string, format: date-time }
        sender: { $ref: '#/components/schemas/AgentIdentity' }
        recipient: { $ref: '#/components/schemas/AgentIdentity' }
        type: { type: string, enum: [OFFER, COUNTEROFFER, ACCEPTANCE, REJECTION, COMMITMENT, EXECUTION_PROOFS, TERMINATION, DISPUTE_RESOLUTION] }
        content: { type: object }

    AgentIdentity:
      type: object
      properties:
        id: { type: string }
        role: { type: string }
        framework: { type: string }

    TransitionResult:
      type: object
      properties:
        accepted: { type: boolean }
        state: { type: string }
        reason: { type: string }
        action: { type: string }

    SharedTaskContract:
      type: object
      properties:
        contractId: { type: string }
        status: { type: string }
        participatingAgents: { type: array, items: { type: string } }
        terms: { type: object }
        deliverables: { type: array, items: { type: object } }

    ActualDeliverable:
      type: object
      properties:
        name: { type: string }
        actualValue: { type: oneOf: [{ type: string }, { type: number }] }
        evidence: { type: string }

    RecommendationRequest:
      type: object
      properties:
        candidateAgents:
          type: array
          items:
            type: string
        maxCoalitionSize:
          type: integer
          minimum: 2
          maximum: 10
        topK:
          type: integer
          minimum: 1
          maximum: 50

    RecommendationResponse:
      type: object
      properties:
        generatedAt:
          type: string
          format: date-time
        recommendations:
          type: array
          items:
            $ref: '#/components/schemas/CoalitionRecommendation'

    CoalitionRecommendation:
      type: object
      properties:
        agents:
          type: array
          items:
            type: string
        predictedSuccessScore:
          type: number
        predictedEconomicScore:
          type: number
        predictedSynergyScore:
          type: number
        predictedCollectiveImpact:
          type: number
        confidence:
          type: number
        rationale:
          type: array
          items:
            type: string
